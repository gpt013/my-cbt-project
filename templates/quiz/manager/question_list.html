{% extends 'base.html' %}
{% load static %}

{% block content %}
<div class="container mt-4" style="max-width: 1000px;">
    
    <div class="d-flex justify-content-between align-items-center mb-4 border-bottom pb-3">
        <div>
            <span class="badge bg-primary mb-2">{{ quiz.get_category_display }}</span>
            <h3 class="fw-bold mb-0 text-dark">
                <i class="bi bi-file-text-fill text-primary"></i> '{{ quiz.title }}' 문제 목록
            </h3>
            <p class="text-muted small mt-1 mb-0">
                <i class="bi bi-clock"></i> {{ quiz.time_limit }}분 | 
                <i class="bi bi-check-circle"></i> {{ quiz.pass_score }}점 합격 | 
                <i class="bi bi-list-ol"></i> 총 {{ quiz.question_count }}문항 설정
            </p>
        </div>
        
        <div class="d-flex gap-2">
            <a href="{% url 'quiz:quiz_question_manager' quiz.id %}" class="btn btn-outline-primary shadow-sm fw-bold">
                <i class="bi bi-bank"></i> 문제 은행
            </a>

            <a href="{% url 'quiz:question_create' quiz.id %}" class="btn btn-success shadow-sm fw-bold">
                <i class="bi bi-plus-lg"></i> 문제 1개 추가
            </a>
            
            <a href="{% url 'quiz:manager_quiz_list' %}" class="btn btn-secondary shadow-sm">
                목록으로
            </a>

            <a href="{% url 'quiz:quiz_update' quiz.id %}" class="btn btn-outline-secondary" title="시험 설정(시간/점수) 수정">
                <i class="bi bi-gear-fill"></i> 설정 수정
            </a>
        </div>
    </div>

    <div class="alert alert-light border d-flex align-items-center mb-4 shadow-sm">
        <i class="bi bi-info-circle-fill text-info fs-5 me-2"></i>
        <div>
            현재 <strong>총 {{ questions|length }}개</strong>의 문제가 등록되어 있습니다.
        </div>
    </div>

    <div class="vstack gap-3">
        {% for question in questions %}
        <div class="card shadow-sm border-0">
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-start mb-3">
                    <div class="d-flex align-items-center gap-2">
                        <span class="badge bg-light text-dark border">Q{{ forloop.counter }}</span>
                        
                        {% if question.difficulty == '상' %}
                            <span class="badge bg-danger">상</span>
                        {% elif question.difficulty == '중' %}
                            <span class="badge bg-warning text-dark">중</span>
                        {% else %}
                            <span class="badge bg-success">하</span>
                        {% endif %}

                        <span class="badge bg-secondary">{{ question.question_type }}</span>

                        {% for tag in question.tags.all %}
                            <span class="badge bg-info text-dark opacity-75">#{{ tag.name }}</span>
                        {% endfor %}
                    </div>

                    <div class="btn-group">
                        
                        <a href="{% url 'quiz:question_update' question.id %}" class="btn btn-sm btn-outline-secondary">
                            <i class="bi bi-pencil"></i> 수정
                        </a>

                        <form action="{% url 'quiz:question_delete' question.id %}" method="POST" class="d-inline" onsubmit="return confirm('이 문제를 삭제하시겠습니까?');">
                            {% csrf_token %}
                            <button type="submit" class="btn btn-sm btn-outline-danger" style="border-top-left-radius: 0; border-bottom-left-radius: 0;">
                                <i class="bi bi-trash"></i>
                            </button>
                        </form>
                    </div>
                </div>

                <h5 class="card-title fw-bold text-dark mb-3" style="white-space: pre-wrap;">{{ question.question_text }}</h5>

                {% if question.image %}
                    <div class="mb-3">
                        <img src="{{ question.image.url }}" alt="문제 이미지" class="img-fluid rounded border p-1" style="max-height: 200px;">
                    </div>
                {% endif %}

                {% if question.choice_set.exists %}
                    <ul class="list-group list-group-flush bg-light rounded">
                        {% for choice in question.choice_set.all %}
                            <li class="list-group-item bg-transparent d-flex align-items-center border-0 py-1">
                                {% if choice.is_correct %}
                                    <i class="bi bi-check-circle-fill text-success me-2"></i>
                                    <span class="fw-bold text-success">{{ choice.choice_text }}</span>
                                {% else %}
                                    <i class="bi bi-circle text-muted me-2"></i>
                                    <span class="text-secondary">{{ choice.choice_text }}</span>
                                {% endif %}
                                
                                {% if choice.image %}
                                    <a href="{{ choice.image.url }}" target="_blank" class="ms-2 badge bg-light text-dark border">
                                        <i class="bi bi-image"></i> 이미지
                                    </a>
                                {% endif %}
                            </li>
                        {% endfor %}
                    </ul>
                {% endif %}
            </div>
        </div>
        {% empty %}
            <div class="text-center py-5">
                <i class="bi bi-clipboard-x display-1 text-muted opacity-25"></i>
                <p class="mt-3 text-muted fw-bold">등록된 문제가 없습니다.</p>
                <p class="small text-secondary">우측 상단의 '문제 1개 추가' 버튼을 눌러 문제를 등록해주세요.</p>
            </div>
        {% endfor %}
    </div>
</div>
{% endblock %}