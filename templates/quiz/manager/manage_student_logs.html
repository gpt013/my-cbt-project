{% extends 'base.html' %}
{% load static %}

{% block content %}
<div class="container mt-4" style="max-width: 1000px;">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h3>ğŸš¨ íŠ¹ì´ì‚¬í•­ ë° ê²½ê³  ê´€ë¦¬</h3>
        <a href="{% url 'quiz:manager_trainee_detail' profile.id %}" class="btn btn-secondary">ëŒì•„ê°€ê¸°</a>
    </div>

    <div class="card bg-light border-0 mb-4">
        <div class="card-body">
            <div class="d-flex align-items-center">
                <h4 class="mb-0 me-3">{{ profile.name }}</h4>
                <div class="me-auto">
                    {% if profile.status == 'attending' %}
                        <span class="badge bg-success">ì •ìƒ (ì¬ì§)</span>
                    {% elif profile.status == 'caution' %}
                        <span class="badge bg-warning text-dark">ì£¼ì˜ (ê²½ê³  1íšŒ)</span>
                    {% elif profile.status == 'counseling' %}
                        <span class="badge bg-danger">ì ê¸ˆ (ë©´ë‹´í•„ìš”)</span>
                    {% elif profile.status == 'dropout' %}
                        <span class="badge bg-dark">í‡´ì†Œ</span>
                    {% endif %}
                </div>
                <div class="text-end">
                    <strong>ëˆ„ì  ê²½ê³ :</strong> <span class="text-danger fs-5 fw-bold">{{ profile.warning_count }}</span> íšŒ
                </div>
            </div>
            <div class="progress mt-2" style="height: 10px;">
                <div class="progress-bar bg-danger" role="progressbar" style="width: {% widthratio profile.warning_count 4 100 %}%;"></div>
            </div>
            <div class="d-flex justify-content-between small text-muted mt-1">
                <span>0íšŒ</span>
                <span>2íšŒ(1ì°¨ ê²½ê³ ì¥)</span>
                <span>3íšŒ(2ì°¨ ê²½ê³ ì¥)</span>
                <span>4íšŒ(í‡´ì†Œ)</span>
            </div>
        </div>
    </div>

    <div class="row">
        <div class="col-md-5">
            <div class="card shadow-sm">
                <div class="card-header bg-white fw-bold">ğŸ“ ìƒˆ ê¸°ë¡ ì‘ì„±</div>
                <div class="card-body">
                    <form method="post">
                        {% csrf_token %}
                        
                        <div class="mb-3">
                            <label class="form-label fw-bold">ìœ í˜• ì„ íƒ</label>
                            {{ form.log_type }}
                        </div>

                        <div class="mb-3">
                            <label class="form-label fw-bold">ì‚¬ìœ  ë° ë‚´ìš© <span class="text-danger">*</span></label>
                            {{ form.reason }}
                            <div class="form-text">
                                * ê²½ê³  ë°œë¶€ ì‹œ <strong>ìœ¡í•˜ì›ì¹™</strong>ì— ì˜ê±°í•˜ì—¬ êµ¬ì²´ì ì¸ ì‚¬ìœ ë¥¼ ì‘ì„±í•´ì£¼ì„¸ìš”.
                            </div>
                        </div>

                        <div class="mb-3 form-check bg-light p-3 rounded border">
                            <input type="checkbox" class="form-check-input" name="resolve_lock" id="resolveCheck">
                            <label class="form-check-label fw-bold text-primary" for="resolveCheck">
                                ğŸ”“ ì¡°ì¹˜ ì™„ë£Œ ë° ì ê¸ˆ í•´ì œ
                            </label>
                            <div class="form-text small">
                                'ë©´ë‹´' ìœ í˜•ì¼ ë•Œ ì²´í¬í•˜ë©´ ê³„ì •ì´ <strong>ì •ìƒ ìƒíƒœ</strong>ë¡œ ë³µêµ¬ë©ë‹ˆë‹¤.
                            </div>
                        </div>

                        <button type="submit" class="btn btn-primary w-100">ë“±ë¡í•˜ê¸°</button>
                    </form>
                </div>
            </div>
        </div>

        <div class="col-md-7">
            <h5 class="fw-bold mb-3">ğŸ“œ ê¸°ë¡ íˆìŠ¤í† ë¦¬</h5>
            <div class="vstack gap-3">
                {% for log in logs %}
                <div class="card border-start border-4 
                    {% if log.log_type == 'warning' %}border-warning
                    {% elif log.log_type == 'warning_letter' %}border-danger
                    {% elif log.log_type == 'counseling' %}border-success
                    {% else %}border-secondary{% endif %} shadow-sm">
                    <div class="card-body">
                        <div class="d-flex justify-content-between mb-2">
                            <span class="badge 
                                {% if log.log_type == 'warning' %}bg-warning text-dark
                                {% elif log.log_type == 'warning_letter' %}bg-danger
                                {% elif log.log_type == 'counseling' %}bg-success
                                {% else %}bg-secondary{% endif %}">
                                {{ log.get_log_type_display }}
                            </span>
                            <small class="text-muted">{{ log.created_at|date:"Y-m-d H:i" }} by {{ log.recorder.profile.name }}</small>
                        </div>
                        <p class="card-text fw-bold mb-1">{{ log.reason|linebreaksbr }}</p>
                        {% if log.is_resolved %}
                            <div class="text-end"><span class="badge bg-primary-subtle text-primary">ì¡°ì¹˜ ì™„ë£Œ</span></div>
                        {% endif %}
                    </div>
                </div>
                {% empty %}
                <div class="text-center text-muted py-5">ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤.</div>
                {% endfor %}
            </div>
        </div>
    </div>
</div>
{% endblock %}