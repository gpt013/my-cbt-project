{% extends 'base.html' %}
{% load static %}

{% block content %}
<div class="container mt-4" style="max-width: 900px;">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h3 class="fw-bold"><i class="bi bi-bell-fill text-warning"></i> 알림 및 피드백 센터</h3>
        <a href="{% url 'quiz:my_page' %}" class="btn btn-outline-secondary">마이페이지</a>
    </div>

    <div class="mb-4">
        <a href="?type=" class="btn btn-sm {% if not filter_type %}btn-dark{% else %}btn-outline-dark{% endif %} rounded-pill me-1">전체</a>
        {% for code, label in log_types %}
            <a href="?type={{ code }}" class="btn btn-sm 
                {% if filter_type == code %}btn-primary{% else %}btn-outline-secondary{% endif %} rounded-pill me-1">
                {{ label }}
            </a>
        {% endfor %}
    </div>

    <div class="list-group shadow-sm">
        {% for log in page_obj %}
        <a href="{% url 'quiz:student_log_detail' log.id %}" class="list-group-item list-group-item-action py-3 border-start border-4 
            {% if log.log_type == 'warning' %}border-warning
            {% elif log.log_type == 'warning_letter' %}border-danger
            {% elif log.log_type == 'counseling' %}border-success
            {% else %}border-info{% endif %}">
            
            <div class="d-flex w-100 justify-content-between align-items-center mb-1">
                <div>
                    <span class="badge rounded-pill me-2
                        {% if log.log_type == 'warning' %}bg-warning text-dark
                        {% elif log.log_type == 'warning_letter' %}bg-danger
                        {% elif log.log_type == 'counseling' %}bg-success
                        {% else %}bg-secondary{% endif %}">
                        {{ log.get_log_type_display }}
                    </span>
                    <small class="text-muted">{{ log.created_at|date:"Y.m.d H:i" }}</small>
                </div>
                {% if log.is_resolved %}
                    <span class="badge bg-primary-subtle text-primary border border-primary">조치 완료</span>
                {% else %}
                    <i class="bi bi-chevron-right text-muted"></i>
                {% endif %}
            </div>
            
            <p class="mb-1 fw-bold text-dark text-truncate" style="max-width: 80%;">
                {{ log.reason }}
            </p>
            
            {% if log.action_taken %}
            <small class="text-danger d-block mt-1">
                <i class="bi bi-exclamation-circle"></i> 조치 사항 있음
            </small>
            {% endif %}
        </a>
        {% empty %}
        <div class="text-center py-5">
            <i class="bi bi-inbox fs-1 text-muted opacity-25"></i>
            <p class="mt-3 text-muted">알림 내역이 없습니다.</p>
        </div>
        {% endfor %}
    </div>

    {% if page_obj.has_other_pages %}
    <div class="d-flex justify-content-center mt-4">
        <ul class="pagination">
            {% if page_obj.has_previous %}
                <li class="page-item"><a class="page-link" href="?page={{ page_obj.previous_page_number }}&type={{ filter_type }}">이전</a></li>
            {% endif %}
            <li class="page-item active"><span class="page-link">{{ page_obj.number }}</span></li>
            {% if page_obj.has_next %}
                <li class="page-item"><a class="page-link" href="?page={{ page_obj.next_page_number }}&type={{ filter_type }}">다음</a></li>
            {% endif %}
        </ul>
    </div>
    {% endif %}
</div>
{% endblock %}